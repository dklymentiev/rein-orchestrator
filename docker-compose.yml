# Rein - Standalone Docker Compose
#
# Quick start:
#   cp .env.example .env        # add your API key
#   docker compose up hello     # run hello-world example
#
# Run any workflow:
#   docker compose run --rm rein --agents-dir /workspace/agents workflow.yaml --no-ui
#
# Daemon mode (watches for tasks):
#   docker compose up -d rein-daemon

services:
  # Hello-world example (quickest way to try Rein)
  hello:
    build: .
    command: ["--agents-dir", "/workspace/agents", "/workspace/workflow.yaml", "--no-ui"]
    volumes:
      - ./examples/01-hello-world:/workspace:ro
      - rein-runs:/tmp/rein-runs
    env_file: .env
    environment:
      - PYTHONUNBUFFERED=1
    profiles: [default]

  # One-off workflow execution (mount your project)
  rein:
    build: .
    volumes:
      - ${REIN_WORKSPACE:-.}:/workspace
      - rein-runs:/tmp/rein-runs
    working_dir: /workspace
    env_file: .env
    environment:
      - PYTHONUNBUFFERED=1
    profiles: [cli]

  # Background daemon (watches agents/tasks/ for pending work)
  rein-daemon:
    build: .
    container_name: rein-daemon
    restart: unless-stopped
    command: ["--daemon", "--agents-dir", "/agents"]
    volumes:
      - ${REIN_AGENTS_DIR:-./agents}:/agents
      - rein-runs:/tmp/rein-runs
    ports:
      - "${REIN_WS_PORT:-8765}:8765"
    env_file: .env
    environment:
      - PYTHONUNBUFFERED=1
    profiles: [daemon]

volumes:
  rein-runs:
